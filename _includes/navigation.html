<nav>
  <ul>
    {% for item in site.data.navigation %}
      {% comment %} --- Logic to determine the active page --- {% endcomment %}
      {% assign is_active = false %}
      {% if item.url == '/' and page.url == '/' %}
        {% assign is_active = true %}
      {% elsif item.url != '/' and page.url | startswith: item.url %}
        {% assign is_active = true %}
      {% endif %}

      {% comment %} --- Build the class string --- {% endcomment %}
      {% assign li_classes = "" %}
      {% if is_active or (item.sublinks and page.url contains '/code/') %}
        {% assign li_classes = li_classes | append: " active" %}
      {% endif %}
      {% if item.sublinks %}
        {% assign li_classes = li_classes | append: " dropdown" %}
      {% endif %}

      <li class="{{ li_classes | strip }}">
        <a href="{{ item.url | default: '#' | relative_url }}">
          {{ item.title }} {% if item.sublinks %}<span>&#9662;</span>{% endif %}
        </a>
        
        {% if item.sublinks %}
          <ul class="dropdown-menu">
            {% for sublink in item.sublinks %}
              <li><a href="{{ sublink.url | relative_url }}">{{ sublink.title }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>